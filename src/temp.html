<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>

  Rate:
  <input id="rateInput" type="range" min="0" max="100" />

  Ratio:
  <input id="rationInput" type="range" min="0" max="10" />

  Enable:
  <button id="enableButton">Enable</button>

  <p>Current Value: <span id="currentValueLabel">A</span></p>

  <script>

    ( function () {

      const $rateInput = document.getElementById( 'rateInput' );
      const $ratioInput = document.getElementById( 'rationInput' );
      const $enableButton = document.getElementById( 'enableButton' );
      const $currentValueLabel = document.getElementById( 'currentValueLabel' );

      let timer;
      let rateValue;
      let ratioValue;
      let isEnabled = false;
      let i = 0;
      let value = 0;
      let previousValue = 1;
      let max = 10;

      rateValue = 100 - $rateInput.value;
      ratioValue = $ratioInput.value;

      $rateInput.addEventListener( 'input', () => {

        rateValue = 100 - $rateInput.value;

        resetClock();

        console.log( 'rate change', rateValue );

      });

      $ratioInput.addEventListener( 'input', () => {

        ratioValue = $ratioInput.value;

        resetClock();

        console.log( 'ratio change', ratioValue );

      });

      $enableButton.addEventListener( 'click', () => {

        if( !isEnabled ) {

          startClock();

        } else {

          stopClock();

        }

        i = 0;

        isEnabled = !isEnabled;

      });

      function startClock() {

        if( i < ratioValue ) {

          value = 0;

        } else {

          value = 1;

        }

        if( value !== previousValue ) {

          onChange();

        }

        previousValue = value;

        if( i < max - 1 ) {

          ++i;

        } else {

          i = 0;

        }

        timer = setTimeout( startClock, rateValue * 10 );

      }

      function stopClock() {

        clearInterval( timer );

      }

      function resetClock() {

        stopClock();

        if( isEnabled ) {

          startClock();

        }

      }

      function onChange() {

        $currentValueLabel.innerText = ( value === 0 ) ? 'A' : 'B';

      }

    } () );

  </script>

</body>
</html>
